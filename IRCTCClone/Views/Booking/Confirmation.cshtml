@model IRCTCClone.Models.Booking

@{
    ViewData["Title"] = "Booking Confirmation";
}

@{
    var successMessage = TempData["BookingSuccess"] as string;
}

@if (!string.IsNullOrEmpty(successMessage))
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                icon: "success",
                title: "Booking Successful!",
                text: "@successMessage",
                confirmButtonText: "OK",
                confirmButtonColor: "#3085d6",
                timer: 7000,
                timerProgressBar: true
            });
        });
    </script>
}

<div class="booking-confirmation">
    <h2 class="confirmation-title">🎟️ Booking Confirmation</h2>

    <div class="booking-info">
        <p><strong>PNR:</strong> @Model.PNR</p>
        <p><strong>Train:</strong> @Model.TrainNumber - @Model.TrainName</p>
        <p><strong>From:</strong> @Model.Frmst</p>
        <p><strong>To:</strong> @Model.Tost</p>
        <p><strong>Journey Date:</strong> @Model.JourneyDate.ToString("dd-MM-yyyy")</p>

        @if (Model.Train != null && Model.JourneyDate != null)
        {
            var departureDateTime = Model.JourneyDate.Date + Model.Train.Departure;
            <p><strong>Scheduled Departure:</strong> @departureDateTime.ToString("dd-MM-yyyy HH:mm")</p>
        }

        <p><strong>Class:</strong> @Model.ClassCode</p>

        <br />
        <h4>💰 Fare Breakdown</h4>
        <ul class="fare-breakdown">
            <li>
                <p><strong>Base Fare:</strong> ₹@Model.BaseFare</p>
                <p><strong>Quota:</strong> @Model.Quota</p>
                <p>
                    <strong>Convenience Fee (Incl. of GST):</strong>
                    ₹@(Model.GST + 20.00m)
                </p>
                <p>
                    <strong>Travel Insurance:</strong>
                    ₹@(0.45m)
                </p>
                @if (Model.QuotaCharge != 0)
                {
                    <p><strong>Quota Charge:</strong> ₹@Model.QuotaCharge</p>
                }
                <p><strong>Surge Charge:</strong> ₹@Model.SurgeAmount</p>
                <p><strong>Total Fare:</strong> ₹@Model.TotalFare</p>
            </li>
        </ul>


        <p>
            <strong>Status:</strong>
            <span class="@(Model.Status)">
                @Model.Status
            </span>
        </p>
    </div>


    <h3 class="passenger-heading">👥 Details of Passengers</h3>

    <table class="table table-bordered passenger-table">
        <thead>
            <tr>
                <th>Sl. No</th>
                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Status</th>
                <th>Coach</th>
                <th>Seat / Berth</th>
                <th>Current Status</th>
            </tr>
        </thead>

        <tbody>
            @{
                int index = 1;
            }

            @foreach (var item in Model.Passengers)
            {
                string coach = (item.BookingStatus == "CNF" && !string.IsNullOrEmpty(item.SeatPrefix))
                ? item.SeatPrefix
                : "--";

                string seat = !string.IsNullOrEmpty(item.SeatNumber)
                ? item.SeatNumber
                : "--";

                string fullSeat = (coach != "--" && seat != "--") ? coach + seat : "--";

                <tr>
                    <td>@index</td>
                    <td>@item.Name</td>
                    <td>@item.Age</td>
                    <td>@item.Gender</td>
                    <td>@item.BookingStatus</td>
                    <td>@coach</td>
                    <td>@seat</td>
                    <td>@item.BookingStatus</td>
                </tr>

                index++;
            }
        </tbody>
    </table>


<style>
    .fare-breakdown {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 10px 20px;
        list-style-type: none;
    }

        .fare-breakdown li {
            padding: 4px 0;
            border-bottom: 1px dashed #ccc;
        }

            .fare-breakdown li:last-child {
                border-bottom: none;
                font-weight: bold;
                color: #0078d7;
            }

        .passenger-table {
            font-size: 14px;
            background: #fff;
        }

            .passenger-table thead tr {
                background: #dce9f9; /* Light IRCTC-blue */
                color: #003366;
                text-align: center;
            }

            .passenger-table th, .passenger-table td {
                padding: 8px;
                vertical-align: middle;
            }

            .passenger-table tbody tr td {
                text-align: center;
            }
</style>
