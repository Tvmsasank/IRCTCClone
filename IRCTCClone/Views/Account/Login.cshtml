@model IRCTCClone.Models.ViewModels

@{
    ViewData["Title"] = "Login";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="home-layout">

    <!-- LEFT SIDE (existing content stays here) -->
    <div class="home-left">
        <!-- your existing search form code -->
    </div>

    <!-- RIGHT SIDE (NEW) -->
    <div class="home-right">
        <h2 class="indian-railways-text">INDIAN RAILWAYS</h2>
        <p class="railways-tagline">Safety | Security | Punctuality</p>
    </div>

</div>

<section class="page-centered">
    <div class="card auth-card">
        <h2>Login</h2>

        <!-- Show ModelState errors (for invalid email/password) -->
        @if (!ViewData.ModelState.IsValid)
        {
            <div class="" role="alert">
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <p style="color: red !important">@error.ErrorMessage</p>
                }
            </div>
        }

        <form method="post" action="/Account/Login" class="auth-form">

            <input type="hidden" name="returnUrl" value="@ViewBag.ReturnUrl" />

            <label>
                Email
                <input type="email" name="Email" value="@Model.Email" required />
            </label>

            <label style="position: relative;">
                Password
                <input type="password" name="Password" id="passwordInput" required />

                <span id="togglePassword"
                      onclick="togglePasswordVisibility()"
                      style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;">
                    <i class="fa-solid fa-eye"></i>
                </span>
            </label>

            <!-- ✅ CAPTCHA BLOCK START -->
            <label>
                Captcha
                <div style="display:flex; align-items:center; gap:10px; margin-top:6px;">
                    <img id="captchaImg"
                         src="/captcha"
                         alt="Captcha"
                         style="border:1px solid #ccc; height:40px;" />

                    <button type="button"
                            onclick="refreshCaptcha()"
                            style="padding:4px 8px; cursor:pointer;">
                        ↻
                    </button>
                </div>

                <!-- 🔴 NAME MUST MATCH ViewModel -->
                <input type="text"
                       name="CaptchaInput"
                       placeholder="Enter captcha"
                       required />
            </label>
            <!-- ✅ CAPTCHA BLOCK END -->


            <div class="auth-actions">
                <button type="submit" class="btn-primary">Login</button>
                <a class="link-muted" href="/Account/ForgotPassword">Forgot password?</a>
            </div>
        </form>

        <p class="muted small">Don't have an account? <a href="/Account/Register">Register</a></p>
    </div>
</section>

@section Scripts {
    <script>
        function togglePasswordVisibility() {
            const passwordField = document.getElementById('passwordInput');
            const icon = document.querySelector('#togglePassword i');

            if (!passwordField || !icon) return;

            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function refreshCaptcha() {
            document.getElementById("captchaImg").src =
            "/captcha?ts=" + new Date().getTime();
        }

        // ✅ Load captcha on page load
        refreshCaptcha();
    </script>
}
